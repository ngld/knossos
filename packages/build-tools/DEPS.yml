vars:
  PROTOC: 3.18.0
  LIBARCHIVE: 3.5.2
  CEF: 93.1.12+ga8ffe4b+chromium-93.0.4577.82
  MSYS_BUILD: 20210725
  NODEJS: 14.17.6
  BROTLI: 1.0.9
  NINJA: 1.10.2
  GOLANG_CI: 1.42.1

update-checks:
  PROTOC:
    github:
      project: protocolbuffers/protobuf
  LIBARCHIVE:
    github:
      project: libarchive/libarchive
  CEF:
    regex:
      url: https://cef-builds.spotifycdn.com/index.json
      pattern: '"cef_version": "([^"]+)", "channel": "stable",'
  MSYS_BUILD:
    regex:
      url: http://repo.msys2.org/distrib/x86_64/
      pattern: msys2-base-x86_64-([0-9]+)\.tar\.xz
      last: true
  NODEJS:
    regex:
      url: https://nodejs.org/en/
      pattern: ' title="Download ([0-9\.]+) LTS" '
  BROTLI:
    github:
      project: google/brotli
  NINJA:
    github:
      project: ninja-build/ninja
  GOLANG_CI:
    github:
      project: golangci/golangci-lint

deps:
  protoc-linux:
    sha256: 8b6b0c82f730212801d9cce4653abb1a1f4204555a92e8e2b5f625d61e66f1b4
    if: linux && amd64
    url: https://github.com/protocolbuffers/protobuf/releases/download/v{PROTOC}/protoc-{PROTOC}-linux-x86_64.zip
    strip: 1
    dest: third_party/protoc-dist
    markExec: [protoc]

  protoc-darwin:
    sha256: 18c6b9585a0ceff7be1673271b30497f13c3eb8e6894354066c269d2846337c1
    if: darwin && (amd64 || arm64)
    url: https://github.com/protocolbuffers/protobuf/releases/download/v{PROTOC}/protoc-{PROTOC}-osx-x86_64.zip
    strip: 1
    dest: third_party/protoc-dist
    markExec: [protoc]

  protoc-win64:
    sha256: 222ecf84acdaacf2883b95fd83e14f1b3ffb8598f92ad8f595a90e8fd0a8feb8
    if: windows && amd64
    url: https://github.com/protocolbuffers/protobuf/releases/download/v{PROTOC}/protoc-{PROTOC}-win64.zip
    strip: 1
    dest: third_party/protoc-dist

  cef-linux-full:
    sha256: a6dc3bf03e8bcf7e8010899376e4db4f66ff45f70e1c6f3ba02570f5ab443b99
    if: linux && amd64 && !ci
    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_linux64.tar.bz2
    strip: 1
    dest: third_party/cef

  cef-linux:
    sha256: 4c498735fa77b5a183be74eef71bead85ba099db41274a6005f1f28ce464f4eb
    if: linux && amd64 && ci
    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_linux64_minimal.tar.bz2
    strip: 1
    dest: third_party/cef

  cef-darwin-full:
    sha256: dcf611f4edef9057b21e7dbdb8955e02682c07a79972cb98a85bf74ab55e99e0
    if: darwin && (amd64 || arm64) && !ci
    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_macosx64.tar.bz2
    strip: 1
    dest: third_party/cef

  cef-darwin-arm64-full:
    sha256: 25664d74552f9ba29b85cdddcf39d4cab477e6883950735d8a676e224984e761
    # See the note about cef-darwin-arm64 below
    if: darwin && arm64 # && !ci
    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_macosarm64.tar.bz2
    strip: 1
    dest: third_party/cef

  cef-darwin:
    sha256: 764f019808ef06cd3baff70858b95478b02a9e73823b1b72c779fd4acd289faf
    if: darwin && amd64 && ci
    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_macosx64_minimal.tar.bz2
    strip: 1
    dest: third_party/cef

# Disabled for now since the download seems to be missing.
#  cef-darwin-arm64:
#    sha256: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
#    if: darwin && arm64 && ci
#    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_macosarm64_minimal.tar.bz2
#    strip: 1
#    dest: third_party/cef

  cef-win64-full:
    sha256: f1c2c2218cc1dd5141adecdf3fbdec173da57597915a366d1321651bc63f3f02
    if: windows && amd64 && !ci
    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_windows64.tar.bz2
    strip: 1
    dest: third_party/cef

  cef-win64:
    sha256: fc3dbf50225891bfdc26000d704fbb19f0f178425fad7e39d61eaaf141cfaf2b
    if: windows && amd64 && ci
    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_windows64_minimal.tar.bz2
    strip: 1
    dest: third_party/cef

  libarchive:
    sha256: 5f245bd5176bc5f67428eb0aa497e09979264a153a074d35416521a5b8e86189
    url: https://github.com/libarchive/libarchive/releases/download/v{LIBARCHIVE}/libarchive-{LIBARCHIVE}.tar.gz
    strip: 1
    dest: third_party/libarchive

  brotli:
    sha256: f9e8d81d0405ba66d181529af42a3354f838c939095ff99930da6aa9cdf6fe46
    url: https://github.com/google/brotli/archive/v{BROTLI}.tar.gz
    strip: 1
    dest: third_party/brotli

  msys2:
    sha256: 43c09824def2b626ff187c5b8a0c3e68c1063e7f7053cf20854137dc58f08592
    if: windows && amd64 && !ci
    url: http://repo.msys2.org/distrib/x86_64/msys2-base-x86_64-{MSYS_BUILD}.sfx.exe
    sfxArgs: "-y -othird_party"
    dest: third_party/msys64

  nodejs-linux:
    sha256: 3bbe4faf356738d88b45be222bf5e858330541ff16bd0d4cfad36540c331461b
    if: linux && amd64
    url: https://nodejs.org/dist/v{NODEJS}/node-v{NODEJS}-linux-x64.tar.xz
    strip: 1
    dest: third_party/nodejs

  nodejs-darwin:
    sha256: e3e4c02240d74fb1dc8a514daa62e5de04f7eaee0bcbca06a366ece73a52ad88
    if: darwin && (amd64 || arm64)
    url: https://nodejs.org/dist/v{NODEJS}/node-v{NODEJS}-darwin-x64.tar.gz
    strip: 1
    dest: third_party/nodejs

  nodejs-win64:
    sha256: b83e9ce542fda7fc519cec6eb24a2575a84862ea4227dedc171a8e0b5b614ac0
    if: windows && amd64
    url: https://nodejs.org/dist/v{NODEJS}/node-v{NODEJS}-win-x64.zip
    strip: 1
    dest: third_party/nodejs

  ninja-win64:
    sha256: bbde850d247d2737c5764c927d1071cbb1f1957dcabda4a130fa8547c12c695f
    if: windows && amd64
    url: https://github.com/ninja-build/ninja/releases/download/v{NINJA}/ninja-win.zip
    dest: third_party/ninja

  golangci-linux:
    sha256: 214b093c15863430c4b66dd39df677dab6e38fc873ded147e331740d50eea51f
    if: linux && amd64
    url: https://github.com/golangci/golangci-lint/releases/download/v{GOLANG_CI}/golangci-lint-{GOLANG_CI}-linux-amd64.tar.gz
    strip: 1
    dest: third_party/golangci

  golangci-darwin:
    sha256: 9c0042e91218dc1dd4eb7b54e29c7331eff081b3ac3f88b0d5df89b976fcd45c
    if: darwin && (amd64 || arm64)
    url: https://github.com/golangci/golangci-lint/releases/download/v{GOLANG_CI}/golangci-lint-{GOLANG_CI}-darwin-amd64.tar.gz
    strip: 1
    dest: third_party/golangci

  golangci-win64:
    sha256: 607d68f0960e3a7b69c73bc0164710dabb4ece06c509afa3584b475194e8d720
    if: windows && amd64
    url: https://github.com/golangci/golangci-lint/releases/download/v{GOLANG_CI}/golangci-lint-{GOLANG_CI}-windows-amd64.zip
    strip: 1
    dest: third_party/golangci
