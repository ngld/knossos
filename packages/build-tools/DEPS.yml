vars:
  PROTOC: 3.17.3
  LIBARCHIVE: 3.5.1
  CEF: 91.1.23+g04c8d56+chromium-91.0.4472.164
  MSYS_BUILD: 20210604
  NODEJS: 14.17.3
  BROTLI: 1.0.9
  NINJA: 1.10.2
  GOLANG_CI: 1.41.1

update-checks:
  PROTOC:
    github:
      project: protocolbuffers/protobuf
  LIBARCHIVE:
    github:
      project: libarchive/libarchive
  CEF:
    regex:
      url: https://cef-builds.spotifycdn.com/index.json
      pattern: '"cef_version": "([^"]+)", "channel": "stable",'
  MSYS_BUILD:
    regex:
      url: http://repo.msys2.org/distrib/x86_64/
      pattern: msys2-base-x86_64-([0-9]+)\.tar\.xz
      last: true
  NODEJS:
    regex:
      url: https://nodejs.org/en/
      pattern: ' title="Download ([0-9\.]+) LTS" '
  BROTLI:
    github:
      project: google/brotli
  NINJA:
    github:
      project: ninja-build/ninja
  GOLANG_CI:
    github:
      project: golangci/golangci-lint

deps:
  protoc-linux:
    sha256: d4246a5136cf9cd1abc851c521a1ad6b8884df4feded8b9cbd5e2a2226d4b357
    if: linux && amd64
    url: https://github.com/protocolbuffers/protobuf/releases/download/v{PROTOC}/protoc-{PROTOC}-linux-x86_64.zip
    strip: 1
    dest: third_party/protoc-dist
    markExec: [protoc]

  protoc-darwin:
    sha256: 68901eb7ef5b55d7f2df3241ab0b8d97ee5192d3902c59e7adf461adc058e9f1
    if: darwin && (amd64 || arm64)
    url: https://github.com/protocolbuffers/protobuf/releases/download/v{PROTOC}/protoc-{PROTOC}-osx-x86_64.zip
    strip: 1
    dest: third_party/protoc-dist
    markExec: [protoc]

  protoc-win64:
    sha256: c78d42bea30771b81bb3839128ad7ef528b376680bba489998b4a3cd5a495a47
    if: windows && amd64
    url: https://github.com/protocolbuffers/protobuf/releases/download/v{PROTOC}/protoc-{PROTOC}-win64.zip
    strip: 1
    dest: third_party/protoc-dist

  cef-linux-full:
    sha256: 238b32c1f60789d0037265429925f7d6962ce29ac0be1a9043f945409a84acf9
    if: linux && amd64 && !ci
    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_linux64.tar.bz2
    strip: 1
    dest: third_party/cef

  cef-linux:
    sha256: 87edc779d501eafb9d0328e077dcf4541c5848ac28738dd72145b1d6e42b00e7
    if: linux && amd64 && ci
    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_linux64_minimal.tar.bz2
    strip: 1
    dest: third_party/cef

  cef-darwin-full:
    sha256: 6d499c2afbdb8a283ed6000681d21d3358e530fedb4a70eee97cad8732623c50
    if: darwin && (amd64 || arm64) && !ci
    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_macosx64.tar.bz2
    strip: 1
    dest: third_party/cef

  cef-darwin-arm64-full:
    sha256: 9a739f5d52a20a98c7144d7825fdbad70b50e69516c9a128a85859c259823031
    # See the note about cef-darwin-arm64 below
    if: darwin && arm64 # && !ci
    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_macosarm64.tar.bz2
    strip: 1
    dest: third_party/cef

  cef-darwin:
    sha256: abba8849b68eda6a94e809258ad5f33c20b1edbdd4794ac6411c4b3f9b5c4811
    if: darwin && amd64 && ci
    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_macosx64_minimal.tar.bz2
    strip: 1
    dest: third_party/cef

# Disabled for now since the download seems to be missing.
#  cef-darwin-arm64:
#    sha256: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
#    if: darwin && arm64 && ci
#    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_macosarm64_minimal.tar.bz2
#    strip: 1
#    dest: third_party/cef

  cef-win64-full:
    sha256: 25953f0d6467265b64e868abddc4023a3ccf050bcb2a8d4a09b25dd3a0f19389
    if: windows && amd64 && !ci
    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_windows64.tar.bz2
    strip: 1
    dest: third_party/cef

  cef-win64:
    sha256: 3ae62e9783e198f95caf4130efb16938cc0e975c3370151b704a330e309b7be7
    if: windows && amd64 && ci
    url: https://cef-builds.spotifycdn.com/cef_binary_{CEF}_windows64_minimal.tar.bz2
    strip: 1
    dest: third_party/cef

  libarchive:
    sha256: 9015d109ec00bb9ae1a384b172bf2fc1dff41e2c66e5a9eeddf933af9db37f5a
    url: https://github.com/libarchive/libarchive/releases/download/{LIBARCHIVE}/libarchive-{LIBARCHIVE}.tar.gz
    strip: 1
    dest: third_party/libarchive

  brotli:
    sha256: f9e8d81d0405ba66d181529af42a3354f838c939095ff99930da6aa9cdf6fe46
    url: https://github.com/google/brotli/archive/v{BROTLI}.tar.gz
    strip: 1
    dest: third_party/brotli

  msys2:
    sha256: 2d7bdb926239ec2afaca8f9b506b34638c3cd5d18ee0f5d8cd6525bf80fcab5d
    if: windows && amd64 && !ci
    url: http://repo.msys2.org/distrib/x86_64/msys2-base-x86_64-{MSYS_BUILD}.sfx.exe
    sfxArgs: "-y -othird_party"
    dest: third_party/msys64

  nodejs-linux:
    sha256: d659d78144042a1801f35dd611d0fab137e841cde902b2c6a821163a5e36f105
    if: linux && amd64
    url: https://nodejs.org/dist/v{NODEJS}/node-v{NODEJS}-linux-x64.tar.xz
    strip: 1
    dest: third_party/nodejs

  nodejs-darwin:
    sha256: 522f85db1d1fe798cba5f601d1bba7b5203ca8797b2bc934ff6f24263f0b7fb2
    if: darwin && (amd64 || arm64)
    url: https://nodejs.org/dist/v{NODEJS}/node-v{NODEJS}-darwin-x64.tar.gz
    strip: 1
    dest: third_party/nodejs

  nodejs-win64:
    sha256: 170fb4f95539d1d7e1295fb2556cb72bee352cdf81a02ffb16cf6d50ad2fefbf
    if: windows && amd64
    url: https://nodejs.org/dist/v{NODEJS}/node-v{NODEJS}-win-x64.zip
    strip: 1
    dest: third_party/nodejs

  ninja-win64:
    sha256: bbde850d247d2737c5764c927d1071cbb1f1957dcabda4a130fa8547c12c695f
    if: windows && amd64
    url: https://github.com/ninja-build/ninja/releases/download/v{NINJA}/ninja-win.zip
    dest: third_party/ninja

  golangci-linux:
    sha256: 23e1078ab00a750afcde7e7eb5aab8e908ef18bee5486eeaa2d52ee57d178580
    if: linux && amd64
    url: https://github.com/golangci/golangci-lint/releases/download/v{GOLANG_CI}/golangci-lint-{GOLANG_CI}-linux-amd64.tar.gz
    strip: 1
    dest: third_party/golangci

  golangci-darwin:
    sha256: 904a2100b073f67cfc0d9bee48aa75fcf170e3027ca475b1f050af4acc19fcad
    if: darwin && (amd64 || arm64)
    url: https://github.com/golangci/golangci-lint/releases/download/v{GOLANG_CI}/golangci-lint-{GOLANG_CI}-darwin-amd64.tar.gz
    strip: 1
    dest: third_party/golangci

  golangci-win64:
    sha256: b4a8197746dc62cd19c6158616de4ec308a76e2e49beec7095bd60ec293ec220
    if: windows && amd64
    url: https://github.com/golangci/golangci-lint/releases/download/v{GOLANG_CI}/golangci-lint-{GOLANG_CI}-windows-amd64.zip
    strip: 1
    dest: third_party/golangci
